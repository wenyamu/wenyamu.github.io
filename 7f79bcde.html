<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/favicon.ico?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/favicon.ico?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="这是一段文章摘要，是通过 Front-Matter 的 excerpt 属性设置的。 下面的图片也是，它将会出现在你的文章展示页面">
<meta property="og:type" content="article">
<meta property="og:title" content="hexo配置研究">
<meta property="og:url" content="http://8.210.236.200:4000/7f79bcde.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="这是一段文章摘要，是通过 Front-Matter 的 excerpt 属性设置的。 下面的图片也是，它将会出现在你的文章展示页面">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-08T07:28:00.000Z">
<meta property="article:modified_time" content="2024-04-07T10:29:48.962Z">
<meta property="article:author" content="689.im">
<meta name="twitter:card" content="summary"><title>hexo配置研究 | Hexo</title><link ref="canonical" href="http://8.210.236.200:4000/7f79bcde.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: undefined,
  header: undefined,
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: undefined,
  codeblock: {"style":"carbon","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: undefined,
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: {"avoidBanner":true},
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-file-alt"></i></span><span class="header-nav-menu-item__text">文章</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/"><span class="header-nav-submenu-item__text">分类</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/tags/"><span class="header-nav-submenu-item__text">标签</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/archives/"><span class="header-nav-submenu-item__text">档案</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-code"></i></span><span class="header-nav-menu-item__text">语言</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/python/"><span class="header-nav-submenu-item__text">python</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/node/"><span class="header-nav-submenu-item__text">node</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/php/"><span class="header-nav-submenu-item__text">php</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-tv"></i></span><span class="header-nav-menu-item__text">前端</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/html/"><span class="header-nav-submenu-item__text">html</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/js/"><span class="header-nav-submenu-item__text">js</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-server"></i></span><span class="header-nav-menu-item__text">后端</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/linux/"><span class="header-nav-submenu-item__text">linux</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/docker/"><span class="header-nav-submenu-item__text">docker</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/nginx/"><span class="header-nav-submenu-item__text">nginx</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/reward/"><span class="header-nav-menu-item__icon"><i class="fas fa-align-justify"></i></span><span class="header-nav-menu-item__text">打赏</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/friends/"><span class="header-nav-menu-item__icon"><i class="fas fa-align-justify"></i></span><span class="header-nav-menu-item__text">友链</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">hexo配置研究</h1><div class="post-meta"></div></header><div class="post-body">
        <h2><span id="第一次使用hexo">
          第一次使用hexo</span></h2>
      
        <h3><span id="快速使用">
          快速使用</span></h3>
      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g <span class="comment"># 全局安装模块</span></span><br><span class="line">hexo init /hexo <span class="comment"># 新建并初始化项目目录</span></span><br><span class="line"><span class="built_in">cd</span> /hexo</span><br><span class="line">npm install</span><br><span class="line">hexo server <span class="comment"># 简写：hexo s</span></span><br></pre></td></tr></table></div></figure>
<p>然后就可以通过 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://ip:4000/">http://ip:4000</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 打开你的hexo博客了</p>
<!-- more -->

<blockquote>
<p>注意：以下是使用 alpine hexo 容器进行建站</p>
</blockquote>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~/.hexo $ hexo -v</span><br><span class="line">INFO  Validating config</span><br><span class="line">hexo: 6.3.0</span><br><span class="line">hexo-cli: 4.3.1</span><br><span class="line">os: linux 5.10.0-15-amd64 Alpine Linux</span><br><span class="line">node: 18.17.0</span><br><span class="line"></span><br><span class="line">~/.hexo $ npm -v</span><br><span class="line">9.6.6</span><br><span class="line"></span><br><span class="line">~/.hexo $ cat /etc/alpine-release</span><br><span class="line">3.18.3</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2><span id="所有者不是-hexo-的问题">
          所有者不是 hexo 的问题</span></h2>
      <p>1、遇到过编辑文章时，无法保存，服务也不可访问的情况。</p>
<p>2、开启 hexo-abbrlink 也是服务无法访问。</p>
<p>3、hexo-admin 后台看不到文章。</p>
<p>研究发现：文章的所有者不是 hexo 需要修改成 hexo，对应的uid为1000</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件所有者(在宿主机或者容器中以root用户进入执行命令)</span></span><br><span class="line">chown 新所有者名或uid 待修改权限的文件或者目录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改单个文件的所有者</span></span><br><span class="line">chown 1000 test.md</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-R 表示递归，批量修改 _posts 目录自身以及其下的所有子目录和子文件的所有者</span></span><br><span class="line">chown -R 1000 _posts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以root用户进入容器，执行命令</span></span><br><span class="line">docker exec -it -u root my_hexo sh</span><br><span class="line">chown -R hexo .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果不是使用hexo用户执行以上命令，每次操作后都要修改权限（修改目录及文件的所有者为hexo,对应的uid为1000）</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意在宿主机中执行命令，uid 1000 对应的可能是别的用户名，比如：admin。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时你通过ftp查看容器映射到宿主机的文件时，所有者会显示为admin。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其实容器中显示的是hexo，因为uid 1000在容器中对应的就是hexo用户。</span></span><br><span class="line">chown -R 1000 .</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<blockquote>
<p>进入容器，使用hexo用户操作文件或文件夹时所有者就是admin，就不会存在此问题。</p>
</blockquote>

        <h2><span id="hexo-内容管理后台">
          hexo 内容管理后台</span></h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-admin</span><br></pre></td></tr></table></div></figure>
<p>然后就可以通过 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://ip:4000/admin">http://ip:4000/admin</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 打开你的hexo博客后台了</p>

        <h2><span id="使用-hexo-admin-后台执行-deploy">
          使用 hexo-admin 后台执行 deploy</span></h2>
      <p>在 &#x2F;hexo 目录下新建 hexo_deploy.sh 文件代码内容如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env sh</span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></div></figure>
<p>修改 &#x2F;hexo&#x2F;_config.yml 文件，添加以下内容</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># hexo-admin 使用用户:ljs 和密码:ljsljs 登录</span><br><span class="line">admin:</span><br><span class="line">  #username: ljs</span><br><span class="line">  #password_hash: $2a$10$/CFpA2l/UkaHwCPfGus1JuLhZt4vJu1LDTppN39dEgayA0a0Yleqy</span><br><span class="line">  #secret: fdasf789$$%@%@$#</span><br><span class="line">  deployCommand: &#x27;./hexo_deploy.sh&#x27;</span><br></pre></td></tr></table></div></figure>
<blockquote>
<p>以上完成后，在 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://ip:4000/admin/#/deploy">http://ip:4000/admin/#/deploy</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 页面下 点击 deploy 按钮，就可以运行 hexo_deploy.sh</p>
</blockquote>

        <h2><span id="自动生成目录">
          自动生成目录</span></h2>
      <p>如果想让博文自动生成文章目录 需要安装 hexo-toc 插件（有的主题会自带生成目录的功能，像stun）</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-toc</span><br></pre></td></tr></table></div></figure>
<p>然后使用以下标签，写在需要生成目录的位置，一般是放在文章内容顶部</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- toc --&gt;</span></span><br></pre></td></tr></table></div></figure>
<p>安装后如果没有生效，重启hexo服务</p>

        <h2><span id="生成永久链接地址">
          生成永久链接地址</span></h2>
      <p>原理是为 *.md 添加一个标签 abbrlink: 123456</p>
<p>在文章（*.md）修改时（包括文件名和文章内容），插件生成的 abbrlink 值前后都是一样的，相当于生成了一个固定的唯一的url永久地址。</p>
<p>插件 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 生成字母和数字组合</p>
<p>插件 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/rozbo/hexo-abbrlink2">hexo-abbrlink2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 生成递增的数字</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装插件</span></span><br><span class="line">npm install hexo-abbrlink</span><br><span class="line">npm install hexo-abbrlink2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 /hexo/_config.yml文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不带 .html 后缀</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">permalink: posts/:abbrlink/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">带 .html 后缀</span></span><br><span class="line">permalink: posts/:abbrlink.html</span><br><span class="line">abbrlink:</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">hexo-abbrlink 设置</span></span><br><span class="line">  alg: crc32   #算法： crc16(default) and crc32(推荐)</span><br><span class="line">  rep: hex     #进制： dec(default) and hex(推荐)</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">hexo-abbrlink2 设置</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">start: 1000 <span class="comment"># the first id, default 0</span></span></span><br></pre></td></tr></table></div></figure>


        <h2><span id="安装主题">
          安装主题</span></h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /hexo</span><br><span class="line">git clone https://github.com/liuyib/hexo-theme-stun.git themes/stun</span><br><span class="line">npm install hexo-renderer-pug</span><br></pre></td></tr></table></div></figure>

<p>找到 &#x2F;hexo&#x2F;_config.yml 文件 修改主题为 stun</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: stun</span><br></pre></td></tr></table></div></figure>


        <h2><span id="安装本地搜索插件">
          安装本地搜索插件</span></h2>
      <p>在 &#x2F;hexo 下安装本地搜索插件：</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search</span><br></pre></td></tr></table></div></figure>
<p>配置插件，找到 &#x2F;hexo&#x2F;_config.yml 文件，添加以下字段：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.json</span><br><span class="line">  field: post</span><br><span class="line">  content: true</span><br></pre></td></tr></table></div></figure>
<p>生成数据，安装上述插件后，在 &#x2F;hexo 下执行指令：</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></div></figure>
<p>这样会在 &#x2F;hexo&#x2F;public 下生成 search.json 文件，Stun 主题的本地搜索功能就是利用这个文件里的数据实现的。</p>
<p>修改主题配置文件 &#x2F;hexo&#x2F;themes&#x2F;stun&#x2F;_config.yml</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></div></figure>


        <h2><span id="安装pwa插件">
          安装pwa插件</span></h2>
      <p>在 &#x2F;hexo 下安装pwa插件：</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-pwa</span><br></pre></td></tr></table></div></figure>
<p>配置插件<br><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://theme-stun.github.io/docs/zh-CN/advanced/third-part.html#pwa">https://theme-stun.github.io/docs/zh-CN/advanced/third-part.html#pwa</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/lavas-project/hexo-pwa">https://github.com/lavas-project/hexo-pwa</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2><span id="安装-hexo-deploy-部署插件">
          安装 hexo deploy 部署插件</span></h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-rsync</span><br><span class="line">npm install hexo-deployer-git</span><br></pre></td></tr></table></div></figure>

        <h3><span id="hexo-deployer-rsync-插件的使用">
          hexo-deployer-rsync 插件的使用</span></h3>
      <blockquote>
<p>执行 hexo d 发布 public 目录下的静态文件到nginx服务器<br>必须是ssh免密登陆，不然每次还需要输入远程服务器的密码</p>
</blockquote>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 需要使用 root 用户进入容器，不然没有权限安装</span><br><span class="line">docker exec -it --user root hexo sh</span><br><span class="line"></span><br><span class="line"># 安装 rsync 和 openssh</span><br><span class="line">apk update</span><br><span class="line">apk add --update --no-cache rsync openssh</span><br><span class="line"></span><br><span class="line"># 在 hexo 容器中执行，默认3次回车生成公钥和私钥文件</span><br><span class="line"># 记清楚你是使用 哪个用户 运行，例如使用 hexo 用户</span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"># 拷贝容器公钥文件到远程服务器上</span><br><span class="line"># 如果你是使用 hexo 用户运行 ssh-keygen 命令，则执行以下代码：</span><br><span class="line"># 需要输入一次远程服务器 45.77.216.11 的登录密码</span><br><span class="line">ssh-copy-id -i /home/hexo/.ssh/id_rsa.pub root@45.77.216.11</span><br><span class="line"># 如果出现错误 删除 /home/hexo/.ssh/known_hosts 文件即可</span><br><span class="line">rm /home/hexo/.ssh/known_hosts</span><br></pre></td></tr></table></div></figure>

        <h3><span id="hexo-deployer-git-插件的使用">
          hexo-deployer-git 插件的使用</span></h3>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建 github.com 仓库名 wenyamu.github.io</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 ssh key</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认生成公钥的位置</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/home/hexo/.ssh/id_rsa.pub</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">打开 id_rsa.pub 并复制公钥，在 GitHub 中新增一个 ssh key</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">类型 选择 Authentication Key</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">标题 随便写一个</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全局部署 GitHub 用户名和邮箱，让 GitHub 知道你是谁。</span></span><br><span class="line">git config --global user.email xxx@gmail.com</span><br><span class="line">git config --global user.name yyy</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>修改 &#x2F;hexo&#x2F;_config.yml 配置文件，一般在最底部</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line"># 上传到 nginx 服务器</span><br><span class="line">- type: rsync                 # 发布方式</span><br><span class="line">  host: 45.77.216.11          # nginx服务器ip</span><br><span class="line">  user: root                  # ssh登陆用户名</span><br><span class="line">  root: /usr/share/nginx/html # nginx服务器的静态文件目录</span><br><span class="line">  port: 22                    # ssh登陆端口</span><br><span class="line">  delete: true                # 本地public目录中没有，而ssh服务器上有的文件，则被删除</span><br><span class="line">  progress: true              # 显示rsync进展</span><br><span class="line">  args: &quot;&quot;                    # rsync 参数</span><br><span class="line">  rsh: &quot;&quot;                     # 指定要使用的远程shell</span><br><span class="line">  key: &quot;&quot;                     # 定制的SSH私有密钥</span><br><span class="line">  verbose: false              # 是否显示文件上传详细信息</span><br><span class="line">  ignore_errors: false        # 是否忽略错误提示</span><br><span class="line">  create_before_update: false # 首先创建不存在的文件,然后更新现有的文件</span><br><span class="line"># 上传到 github.com 使用 https://wenyamu.github.io/ 访问页面</span><br><span class="line">- type: git</span><br><span class="line">  repo: git@github.com:wenyamu/wenyamu.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></div></figure>


        <h2><span id="让-md-文件名称与文章标题一致">
          让 .md 文件名称与文章标题一致</span></h2>
      <blockquote>
<p>替换 abc.md 文件中的 title: 字段的值为 abc<br>因为 hexo 文章的标题是根据 .md 文件中的 title 字段的值作为标题</p>
</blockquote>
<p>新建 &#x2F;hexo&#x2F;retitle.js</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> ** 替换 abc.md 文件中的 title: 字段的值为 abc</span></span><br><span class="line"><span class="comment"> ** 因为 hexo 文章的标题是根据 .md 文件中的 title 字段的值作为标题</span></span><br><span class="line"><span class="comment"> ** 修改 .md 的文件名称很方便 但是 title 字段的值不方便修改</span></span><br><span class="line"><span class="comment"> **</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// 对单个文件操作</span></span><br><span class="line"><span class="comment">const fs = require(&#x27;fs&#x27;);</span></span><br><span class="line"><span class="comment">const filePath = &#x27;./path/to/123456.md&#x27;;</span></span><br><span class="line"><span class="comment">const fileData = fs.readFileSync(filePath, &#123; encoding: &#x27;utf8&#x27; &#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">var RegExp=/(title:\s*)(.*)/g; // 匹配 .md 文件中 title: 后面的参数值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if(RegExp.test(fileData))&#123; //如果匹配到`title`字段</span></span><br><span class="line"><span class="comment">  var title = fileData.match(RegExp)[0]; // 匹配结果返回 title: aaaa</span></span><br><span class="line"><span class="comment">  var name  = title.substr(7); // 得到 title 参数值 aaa</span></span><br><span class="line"><span class="comment">  console.log(title);</span></span><br><span class="line"><span class="comment">  console.log(name);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  // 替换 title 参数值（只替换从文件顶部开始匹配到的第一个）</span></span><br><span class="line"><span class="comment">  const modifiedData = fileData.replace(name, &#x27;bar&#x27;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  // 将修改后的数据写回到文件中</span></span><br><span class="line"><span class="comment">  fs.writeFileSync(filePath, modifiedData);</span></span><br><span class="line"><span class="comment">  //console.log(&#x27;数据已修改&#x27;);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对文件夹下的每个文件 操作*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入fs操作文件</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> join = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>).<span class="property">join</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置要操作的文件夹</span></span><br><span class="line"><span class="keyword">var</span> dirpath = <span class="string">&quot;./source/_posts/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAllFiles</span>(<span class="params">dir</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> jsonFiles = [];</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findJsonFile</span>(<span class="params">path</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> files = fs.<span class="title function_">readdirSync</span>(path);</span><br><span class="line">    files.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">item, index</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> fPath = <span class="title function_">join</span>(path,item);</span><br><span class="line">      <span class="keyword">let</span> stat = fs.<span class="title function_">statSync</span>(fPath);</span><br><span class="line">      <span class="keyword">if</span>(stat.<span class="title function_">isDirectory</span>() === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="title function_">findJsonFile</span>(fPath);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (stat.<span class="title function_">isFile</span>() === <span class="literal">true</span>) &#123; </span><br><span class="line">        jsonFiles.<span class="title function_">push</span>(fPath);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">findJsonFile</span>(dir);</span><br><span class="line">  <span class="comment">//console.log(jsonFiles);//指定目录下的文件，包括子目录</span></span><br><span class="line">  <span class="keyword">return</span> jsonFiles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doFileEdit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 文件夹下每个文件的路径json数据</span></span><br><span class="line">  <span class="keyword">var</span> filesPathJson = <span class="title function_">getAllFiles</span>(dirpath);</span><br><span class="line">  <span class="comment">//console.log(filesPathJson);</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; filesPathJson.<span class="property">length</span>; i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> _file = filesPathJson[i]; <span class="comment">// path/to/123456.md</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> filename = _file.<span class="title function_">substr</span>(_file.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>)+<span class="number">1</span>); <span class="comment">// 123456.md</span></span><br><span class="line">    <span class="keyword">var</span> md_name  = filename.<span class="title function_">slice</span>(<span class="number">0</span>,-<span class="number">3</span>); <span class="comment">// 123456</span></span><br><span class="line">    <span class="comment">//console.log(md_name);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fileData = fs.<span class="title function_">readFileSync</span>(_file, &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf8&#x27;</span> &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 匹配 .md 文件中 title: 后面的参数值(.md 文件中 冒号后面有空格)</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">RegExp</span>=<span class="regexp">/(title:\s*)(.*)/g</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">RegExp</span>.<span class="title function_">test</span>(fileData))&#123; <span class="comment">//如果匹配到`title`字段</span></span><br><span class="line">      <span class="keyword">var</span> md_title_str = fileData.<span class="title function_">match</span>(<span class="title class_">RegExp</span>)[<span class="number">0</span>]; <span class="comment">// 返回 title: aaaa</span></span><br><span class="line">      <span class="keyword">var</span> md_title_var  = md_title_str.<span class="title function_">substr</span>(<span class="number">7</span>); <span class="comment">// 返回 title 参数值 aaa</span></span><br><span class="line">      <span class="comment">//console.log(md_title_str);</span></span><br><span class="line">      <span class="comment">//console.log(md_title_var);</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 如果 .md 文件中的 title 参数值 与 .md 文件名称不一致，则修改</span></span><br><span class="line">      <span class="keyword">if</span>(md_title_var != md_name)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;\x1B[35m&quot;</span></span><br><span class="line">        + filename</span><br><span class="line">        + <span class="string">&quot;\x1B[0m&quot;</span></span><br><span class="line">        + <span class="string">&quot;  &quot;</span></span><br><span class="line">        + md_title_str</span><br><span class="line">        + <span class="string">&quot;\x1B[32m ===&gt; \x1B[0m&quot;</span></span><br><span class="line">        + <span class="string">&quot;\x1B[36m&quot;</span></span><br><span class="line">        + md_name</span><br><span class="line">        + <span class="string">&quot;\x1B[0m&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 替换 title 参数值（只替换从文件顶部开始匹配到的第一个）</span></span><br><span class="line">        <span class="keyword">var</span> modifiedData = fileData.<span class="title function_">replace</span>(md_title_var, md_name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将修改后的数据写回到文件中</span></span><br><span class="line">        fs.<span class="title function_">writeFileSync</span>(_file, modifiedData);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\x1B[1m ---修改文件列表--- \x1B[0m&quot;</span>);</span><br><span class="line"><span class="title function_">doFileEdit</span>();</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>先执行 node retitle.js<br>再执行 hexo g </p>

        <h2><span id="hexo-常用命令">
          hexo 常用命令</span></h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化</span></span><br><span class="line">hexo init</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 Hexo 服务器</span></span><br><span class="line">hexo server</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除缓存文件 (db.json) 和已生成的静态文件 (public)</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成全局静态文件</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成静态文件并部署</span></span><br><span class="line">hexo g -d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署</span></span><br><span class="line">hexo d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署前生成静态文件</span></span><br><span class="line">hexo d -g</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 Hexo 版本</span></span><br><span class="line">hexo version</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>然后项目目录下会生成一个 public 文件夹，静态文件都在其中，最后就可以布署到nginx服务器上了。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/f255ffad.html"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">docker镜像与容器打包及上传到仓库</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/15af28d0.html"><span class="paginator-prev__text">一文搞懂 flask gunicorn supervisor 的作用和关系</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span class="daydayup">好好学习，天天向上！</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/velocity/1.5.2/velocity.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/velocity/1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="https://cdn.bootcdn.net/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title","#main",".pjax-reload",".header-inner"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // 加载进度条的计时器
  var loadingTimer = null;

  // 重置页面 Y 方向上的滚动偏移量
  document.addEventListener('pjax:send', function () {
    $('.header-nav-menu').removeClass('show');
    if (CONFIG.pjax && CONFIG.pjax.avoidBanner) {
      $('html').velocity('scroll', {
        duration: 500,
        offset: $('#header').height(),
        easing: 'easeInOutCubic'
      });
    }

    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    if (Stun.utils.pjaxReloadBoot) {
      Stun.utils.pjaxReloadBoot();
    }
    if (Stun.utils.pjaxReloadScroll) {
      Stun.utils.pjaxReloadScroll();
    }
    if (Stun.utils.pjaxReloadSidebar) {
      Stun.utils.pjaxReloadSidebar();
    }
    if (true) {
      if (Stun.utils.pjaxReloadHeader) {
        Stun.utils.pjaxReloadHeader();
      }
      if (Stun.utils.pjaxReloadScrollIcon) {
        Stun.utils.pjaxReloadScrollIcon();
      }
      if (Stun.utils.pjaxReloadLocalSearch) {
        Stun.utils.pjaxReloadLocalSearch();
      }
    }
  }, false);
}, false);</script><div id="pjax-reload"></div><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script type="application/json" src="/search.json"></script></body></html>